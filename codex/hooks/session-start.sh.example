#!/usr/bin/env bash
# SessionStart Hook for .codex
# ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®è‡ªå‹•å‡¦ç†

set -euo pipefail

# jqå‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯
if ! command -v jq &> /dev/null; then
    echo '{"error": "jq not installed. Please run: brew install jq"}' >&2
    exit 1
fi

# JSONå…¥åŠ›ã‚’èª­ã¿è¾¼ã‚€
INPUT=$(cat)

# Serena MCPãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯
if echo "$INPUT" | jq -e '.mcp_servers | has("serena")' > /dev/null 2>&1; then
  cat <<EOF
{
  "systemMessage": "âœ… .codex session initialized",
  "additionalContext": "**Serena MCP active**: onboarding memory loaded

**AIé‹ç”¨7åŽŸå‰‡**:
1. è³ªå•æ™‚: \`afplay ~/button.mp3\`
2. å…¨æŒ‡ç¤ºã‚’ \`/serena\` ã§å®Ÿè¡Œ
3. è¨ˆç”»æ™‚ã¯ Context7 ã§æœ€æ–°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèª
4. å‹æ‰‹ãªæ•´å½¢ãƒ»lintç¦æ­¢ï¼ˆgitå·®åˆ†ç¯„å›²ã®ã¿ï¼‰
5. å®Œäº†æ™‚: \`afplay ~/notification.mp3\` + ãƒˆãƒ¼ã‚¯ãƒ³è¡¨ç¤º
6. åž‹å®‰å…¨æ€§åŽ³å®ˆï¼ˆ\`any\` ç¦æ­¢ï¼‰

**Development Principles**:
- âœ… å®‰å…¨æ“ä½œ: å³å®Ÿè¡Œ
- âš ï¸ è¦ç¢ºèªæ“ä½œ: git/file operations require confirmation
- ðŸš« ç¦æ­¢æ“ä½œ: dangerous operations blocked
- Type safety: Avoid 'any', minimize 'as'

Run: \`mcp__serena__list_memories\`, \`mcp__serena__check_onboarding_performed\`"
}
EOF
else
  cat <<EOF
{
  "systemMessage": "âš ï¸ Serena not configured - basic mode",
  "additionalContext": "**AIé‹ç”¨7åŽŸå‰‡**:
1. è³ªå•æ™‚: \`afplay ~/button.mp3\`
2. å…¨æŒ‡ç¤ºã‚’ \`/serena\` ã§å®Ÿè¡Œ
3. è¨ˆç”»æ™‚ã¯ Context7 ã§æœ€æ–°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèª
4. å‹æ‰‹ãªæ•´å½¢ãƒ»lintç¦æ­¢
5. å®Œäº†æ™‚: \`afplay ~/notification.mp3\`
6. åž‹å®‰å…¨æ€§åŽ³å®ˆï¼ˆ\`any\` ç¦æ­¢ï¼‰

**Development Principles**:
- âœ… å®‰å…¨æ“ä½œ: å³å®Ÿè¡Œ
- âš ï¸ è¦ç¢ºèªæ“ä½œ: require confirmation
- ðŸš« ç¦æ­¢æ“ä½œ: blocked
- Type safety: Avoid 'any', minimize 'as'"
}
EOF
fi
