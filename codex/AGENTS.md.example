# Codex 設定ガイド

> このファイルは Codex (gpt-5.2-codex) 専用の運用ガイドです。

---

## 開発原則

**操作分類** (自動判定):
- ✅ **安全操作**: 即実行（読み取り、分析、メモリー確認）
- ⚠️ **要確認操作**: 事前確認（設定変更、hooks編集）
- 🚫 **禁止操作**: 拒否（機密情報の直接編集）

**その他の原則**:
1. **型安全**: `any` 禁止、`as` 控える
2. **確認優先**: 不明点は確認してから実行

---

## .codex 特有の注意事項

### 設定ファイルの扱い

| ファイル | 用途 | 編集方針 |
|---------|------|---------|
| `config.toml` | メイン設定 | ⚠️ 慎重に編集（バックアップ推奨） |
| `AGENTS.md` | 運用ガイド | 🔒 保護セクション以外は編集可 |
| `.serena/project.yml` | Serena設定 | ⚠️ 最適化時のみ編集 |
| `hooks/*.sh` | フック処理 | ⚠️ 動作確認後に編集 |
| `.gitignore` | Git除外設定 | ✅ 必要に応じて追加 |

### セキュリティ

- **APIキー**: 環境変数で管理（config.toml に直接記載しない）
- **機密ファイル**: `.gitignore` で保護
- **ログファイル**: `log/` に保存（自動除外）

---

## 利用可能なコマンド

ai-toolsリポジトリの`claude-code/commands/`からコマンドが利用可能です（シンボリックリンク経由）。

詳細は `COMMANDS.md` を参照してください。

---

## MCP サーバー構成

| MCP | 用途 | 優先度 |
|-----|------|--------|
| **serena** | セマンティックコード解析 | 高 |
| **context7** | 最新ドキュメント取得 | 高 |
| **playwright** | ブラウザ自動化 | 任意 |

設定詳細: `config.toml` 参照

**Note**: Codex自体はMCPサーバーではなく、gpt-5.2-codexモデルを使用するCLIツールです。

---

## メンテナンス

### 定期作業

- **3ヶ月ごと**: 不要なログ削除 (`log/`)
- **6ヶ月ごと**: MCP設定見直し
- **必要時**: 設定ファイルのバックアップ

---

## Claude設定との統合

> 詳細は `~/.claude/CLAUDE.md` 参照

### 複雑度判定

タスク受領時に複雑度を判定し、適切な実装手法を選択：

| 条件 | 判定 | アクション |
|------|------|-----------|
| ファイル数<5 AND 行数<300 | **Simple** | 直接実装 |
| ファイル数≥5 OR 独立機能≥3 | **TaskDecomposition** | Tasks + 5フェーズ |
| 複数プロジェクト横断 | **AgentHierarchy** | PO/Manager/Developer |

### コマンド選択

```
迷ったら → /flow（タスク自動判定）
実装明確 → /dev
レビュー → /review
一括処理 → /commit-push-pr
```

### 主要エイリアス

| エイリアス | フルコマンド | 頻度 |
|-----------|-------------|------|
| `/cpr` | `/commit-push-pr` | ⭐⭐⭐⭐⭐ |
| `/rv` | `/review` | ⭐⭐⭐⭐ |
| `/tdd` | `/superpowers:test-driven-development` | ⭐⭐⭐ |

### 検証フロー

```
/dev 完了 → verify-app → 問題あり → 修正 → 再検証
                       → 問題なし → PR作成
```

**検証内容**: ビルド・テスト・lint を包括的に実行

### 2回失敗ルール

同じアプローチで2回失敗した場合：

```
失敗1回目 → アプローチ微調整
失敗2回目 → /clear → 問題再整理 → 新アプローチ提案
```

**理由**: コンテキスト汚染による悪循環防止

### トークン節約

1. **summaries/優先**: 詳細読む前にsummary読了（70%削減）
2. **Context7活用**: コード例はContext7から取得
3. **300行超は分割**: offset/limit使用

---

## 関連ドキュメント

- **コマンド詳細**: `COMMANDS.md`
- **設定詳細**: `config.toml`
- **ai-toolsリポジトリ**: `~/ai-tools/`

---

**最終更新**: 2026-01-25
**バージョン**: 3.0.0 (シンプル版)
