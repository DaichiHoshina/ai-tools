# Rust ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

Rust 2024 Editionå¯¾å¿œã€‚å…±é€šã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ `~/.claude/guidelines/common/` å‚ç…§ã€‚

---

## åŸºæœ¬åŸå‰‡

- **æ‰€æœ‰æ¨©**: å€Ÿç”¨ãƒã‚§ãƒƒã‚«ãƒ¼ã«å¾“ã†
- **ã‚¼ãƒ­ã‚³ã‚¹ãƒˆæŠ½è±¡åŒ–**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–
- **å®‰å…¨æ€§**: `unsafe` ã¯æœ€å°é™
- **ãƒ„ãƒ¼ãƒ«**: `cargo fmt`, `clippy`, `rustfmt` å¿…é ˆ
- **Idiomå„ªå…ˆ**: å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

- `src/` - ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
  - `main.rs` ã¾ãŸã¯ `lib.rs`
  - `bin/` - è¤‡æ•°ãƒã‚¤ãƒŠãƒª
- `tests/` - çµ±åˆãƒ†ã‚¹ãƒˆ
- `benches/` - ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- `Cargo.toml` - ä¾å­˜é–¢ä¿‚

---

## å‹ã‚·ã‚¹ãƒ†ãƒ 

### åŸºæœ¬
- `struct` - ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- `enum` - ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹
- `trait` - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- `impl` - å®Ÿè£…ãƒ–ãƒ­ãƒƒã‚¯

### ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹
- `fn process<T: Display>(item: T)` - ãƒˆãƒ¬ã‚¤ãƒˆå¢ƒç•Œ
- `where T: Clone + Send` - è¤‡é›‘ãªå¢ƒç•Œ
- `impl<T> Trait for Type<T>` - blanket impl

---

## å‘½åè¦å‰‡

- **ã‚¯ãƒ¬ãƒ¼ãƒˆ/ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: `snake_case`
- **å‹/ãƒˆãƒ¬ã‚¤ãƒˆ**: `PascalCase`
- **é–¢æ•°/å¤‰æ•°**: `snake_case`
- **å®šæ•°**: `SCREAMING_SNAKE_CASE`
- **ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ **: `'a`, `'static`

---

## ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### ã‚¨ãƒ©ãƒ¼å‡¦ç†

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ã‚³ãƒ¼ãƒ‰ | ç”¨é€” |
|---------|--------|------|
| Result | `fn f() -> Result<T, E>` | å›å¾©å¯èƒ½ã‚¨ãƒ©ãƒ¼ |
| Option | `fn find() -> Option<T>` | å€¤ã®æœ‰ç„¡ |
| ? æ¼”ç®—å­ | `let x = try_fn()?;` | ã‚¨ãƒ©ãƒ¼ä¼æ’­ |
| anyhow | `anyhow::Result<T>` | ã‚¢ãƒ—ãƒªã‚¨ãƒ©ãƒ¼ |
| thiserror | `#[derive(Error)]` | ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¨ãƒ©ãƒ¼ |

### æ‰€æœ‰æ¨©

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ã‚³ãƒ¼ãƒ‰ | ç”¨é€” |
|---------|--------|------|
| æ‰€æœ‰æ¨©ç§»å‹• | `let b = a;` | æ‰€æœ‰æ¨©è­²æ¸¡ |
| å€Ÿç”¨ | `&value` | ä¸å¤‰å‚ç…§ |
| å¯å¤‰å€Ÿç”¨ | `&mut value` | å¯å¤‰å‚ç…§ |
| Clone | `value.clone()` | æ˜ç¤ºçš„ã‚³ãƒ”ãƒ¼ |
| Rc/Arc | `Arc::new(data)` | å…±æœ‰æ‰€æœ‰æ¨© |

### éåŒæœŸå‡¦ç†

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ã‚³ãƒ¼ãƒ‰ | ç”¨é€” |
|---------|--------|------|
| async fn | `async fn fetch() -> Result<T>` | éåŒæœŸå®šç¾© |
| await | `result.await?` | éåŒæœŸå¾…æ©Ÿ |
| spawn | `tokio::spawn(task)` | ã‚¿ã‚¹ã‚¯ç”Ÿæˆ |
| join | `tokio::join!(a, b)` | ä¸¦è¡Œå®Ÿè¡Œ |

### ãƒ†ã‚¹ãƒˆ

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | ã‚³ãƒ¼ãƒ‰ | ç”¨é€” |
|---------|--------|------|
| å˜ä½“ | `#[test] fn test_fn()` | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ |
| éåŒæœŸ | `#[tokio::test]` | éåŒæœŸãƒ†ã‚¹ãƒˆ |
| å¤±æ•—æœŸå¾… | `#[should_panic]` | ãƒ‘ãƒ‹ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ |
| ç„¡è¦– | `#[ignore]` | ã‚¹ã‚­ãƒƒãƒ— |

## ã‚ˆãã‚ã‚‹ãƒŸã‚¹

| âŒ é¿ã‘ã‚‹ | âœ… ä½¿ã† | ç†ç”± |
|----------|---------|------|
| `.unwrap()` ä¹±ç”¨ | `?` ã¾ãŸã¯ `expect()` | ãƒ‘ãƒ‹ãƒƒã‚¯é˜²æ­¢ |
| `.clone()` ä¹±ç”¨ | å€Ÿç”¨ã§è§£æ±º | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ |
| `unsafe` å¤šç”¨ | å®‰å…¨ãªä»£æ›¿ | ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ |
| `String` è¿”å´ | `&str` å€Ÿç”¨ | ä¸è¦ãªã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ |
| å¤§ããª `enum` | `Box<dyn Trait>` | ã‚¹ã‚¿ãƒƒã‚¯ã‚µã‚¤ã‚º |

---

## å¤ã„ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼/å®Ÿè£…æ™‚ãƒã‚§ãƒƒã‚¯ï¼‰

`Cargo.toml` ã® `edition` ã¨ `rust-version` ã‚’ç¢ºèªã—ã¦ã‹ã‚‰æŒ‡æ‘˜ã™ã‚‹ã€‚

### ğŸ”´ Criticalï¼ˆå¿…ãšæŒ‡æ‘˜ï¼‰

| âŒ å¤ã„ | âœ… ãƒ¢ãƒ€ãƒ³ | Since |
|---------|----------|-------|
| `#[async_trait]` ãƒã‚¯ãƒ­ï¼ˆå¤§åŠã®ã‚±ãƒ¼ã‚¹ï¼‰ | ãƒã‚¤ãƒ†ã‚£ãƒ– `async fn` in trait (RPITIT) | Edition 2024 |
| `impl Trait` è¿”å´ä¸å¯ï¼ˆãƒˆãƒ¬ã‚¤ãƒˆå†…ï¼‰ | `fn f() -> impl Trait` in trait | 1.75 |
| `lazy_static!` ãƒã‚¯ãƒ­ | `std::sync::LazyLock` / `std::cell::LazyCell` | 1.80 |
| `once_cell::sync::Lazy` | `std::sync::LazyLock` | 1.80 |

### ğŸŸ¡ Warningï¼ˆç©æ¥µçš„ã«æŒ‡æ‘˜ï¼‰

| âŒ å¤ã„ | âœ… ãƒ¢ãƒ€ãƒ³ | Since |
|---------|----------|-------|
| `Box<dyn Fn()>` ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£è¿”å´ | `impl Fn()` è¿”å´ï¼ˆRPITITï¼‰ | 1.75 |
| `if let Some(x) = a { if let Some(y) = b { } }` | `let chains`: `if let Some(x) = a && let Some(y) = b` | Edition 2024 |
| æ‰‹å‹•ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿å®Ÿè£… | `gen` ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ï¼‰ | Edition 2024 |
| `async move \|\| { }` | `async \|\| { }` ï¼ˆasyncã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å®‰å®šåŒ–ï¼‰ | Edition 2024 |
| `log` ã‚¯ãƒ¬ãƒ¼ãƒˆ | `tracing` ã‚¯ãƒ¬ãƒ¼ãƒˆï¼ˆæ§‹é€ åŒ–ãƒ­ã‚° + ã‚¹ãƒ‘ãƒ³ï¼‰ | æ¨å¥¨ |
| `failure` ã‚¯ãƒ¬ãƒ¼ãƒˆ | `thiserror` + `anyhow` | æ¨å¥¨ |
| `reqwest::blocking` | `reqwest` async + tokio | æ¨å¥¨ |
| `println!` ãƒ‡ãƒãƒƒã‚° | `tracing::debug!` / `dbg!` | æ¨å¥¨ |
| `#[derive(Clone, Debug)]` æ‰‹å‹•åˆ—æŒ™ | `#[diagnostic]` å±æ€§ã§æ”¹å–„ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ´»ç”¨ | 1.80 |

### â„¹ï¸ Infoï¼ˆææ¡ˆãƒ¬ãƒ™ãƒ«ï¼‰

| é …ç›® | å†…å®¹ | Since |
|------|------|-------|
| `cargo clippy --fix` | å¤šãã®å¤ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è‡ªå‹•ä¿®æ­£ | å¸¸ç”¨ |
| Edition 2024 ç§»è¡Œ | `cargo fix --edition` ã§è‡ªå‹•ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | 2024 |

---

## ã‚¯ãƒ¬ãƒ¼ãƒˆæ¨å¥¨

| ã‚«ãƒ†ã‚´ãƒª | ã‚¯ãƒ¬ãƒ¼ãƒˆ |
|---------|---------|
| éåŒæœŸ | `tokio`, `futures` |
| Web | `axum`, `reqwest`, `serde` |
| ã‚¨ãƒ©ãƒ¼ | `thiserror` (ãƒ©ã‚¤ãƒ–ãƒ©ãƒª), `anyhow` (ã‚¢ãƒ—ãƒª) |
| CLI | `clap`, `tracing`, `color-eyre` |
