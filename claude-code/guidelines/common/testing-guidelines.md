# テストガイドライン

## 基本原則

| 原則 | 説明 |
|------|------|
| バグの早期発見 | コードの問題を早期に検出 |
| リファクタリングの安全性 | 変更が既存機能を壊していないことを確認 |
| ドキュメント | テストコードは仕様書としての役割 |
| 設計の改善 | テスタブルなコードは良い設計の指標 |

## クイックリファレンス

### テストの種類

| 種類 | 対象 | 特徴 | テストピラミッド |
|------|------|------|-----------------|
| 単体テスト | 関数・メソッド単位 | 高速、独立、外部依存なし | 多（基盤） |
| 統合テスト | 複数モジュール連携 | DB・外部API使用 | 中 |
| E2Eテスト | システム全体 | 最も遅い、壊れやすい | 少（頂点） |

### AAA パターン

| フェーズ | 説明 | 例 |
|---------|------|-----|
| Arrange | テストデータ・モック準備 | `const user = { id: 1 }` |
| Act | テスト対象を実行 | `const result = getUser(1)` |
| Assert | 結果を検証 | `expect(result).toBe(user)` |

### 命名規則

| パターン | 形式 | 例 |
|---------|------|-----|
| should型 | `should + 期待する動作` | `should return user when valid ID` |
| 対象-条件-結果型 | `[対象] + [条件] + [結果]` | `createUser with invalid email throws error` |
| 日本語 | 自然言語 | `有効なIDでユーザーを取得できる` |

**重要**: 何をテストしているか・期待する動作が一目でわかること

## ベストプラクティス

| 原則 | 説明 |
|------|------|
| 独立性 | テスト間で状態を共有しない |
| 高速 | 外部依存はモック化 |
| 決定論的 | 同じ入力で常に同じ結果 |
| シンプル | 1テスト1振る舞い |
| 振る舞いをテスト | 内部実装ではなく公開APIをテスト |

## モックとスタブ

| ルール | 説明 |
|--------|------|
| 外部依存をモック化 | DB、外部API、ファイルシステム |
| 内部ロジックはモック化しない | テスト対象の内部実装に依存しない |

## よくあるミス

| ❌ 避ける | ✅ 使う | 理由 |
|----------|---------|------|
| 内部実装（privateフィールド）に依存 | 公開APIで検証 | 実装変更に強い |
| 実際のDBを使用 | モック・インメモリDB | 高速化・独立性 |
| テスト間で状態共有 | 各テストで初期化 | 独立性・決定論性 |
| 1テストで複数の振る舞い検証 | 1テスト1振る舞い | 失敗箇所の特定 |

## テストカバレッジ

| 項目 | 基準 |
|------|------|
| 目標 | 80%以上 |
| 重要 | カバレッジは手段、目的ではない |
| 優先順位 | ビジネスロジック > インフラ層 |

## 言語別ツール

| 言語/FW | テストツール | 特徴 |
|---------|-------------|------|
| Go | `testing` (標準) | テーブル駆動テスト推奨 |
| TypeScript | Vitest, Jest | 高速、型安全 |
| React | Testing Library | ユーザー視点のテスト |
| E2E | Playwright | クロスブラウザ対応 |

### Go: テーブル駆動テスト

**同じロジックを複数の入力パターンで検証**

```go
tests := []struct {
  input int
  want  int
}{
  {1, 2}, {2, 4},
}
```

**Why**: メンテナンス性向上
