# セッションモード

セッション全体の動作モードを定義。モードに応じて確認フローと制約レベルが変化。

---

## モード一覧

| モード | 確認レベル | ユースケース |
|--------|----------|-------------|
| **strict** | すべてのBoundary操作で確認 | 本番作業、重要リファクタリング |
| **normal** | 標準的な確認（デフォルト） | 通常の開発作業 |
| **fast** | 確認を最小化 | プロトタイピング、探索的開発 |

---

## strict モード

**最も厳格なモード。すべての重要操作で確認を求める。**

### 確認が必要な操作
- git commit / push / merge
- ファイル削除
- 設定ファイル変更（.env, package.json, go.mod等）
- npm install / go get 等のパッケージ追加
- データベース操作

### 自動許可される操作
- ファイル読み取り
- コード分析
- 提案・説明

### 使用シーン
- 本番環境に関わる作業
- 重要なリファクタリング
- セキュリティに関わる変更
- 複数人が関わるプロジェクト

---

## normal モード（デフォルト）

**標準的なバランス。8原則に従う。**

### 確認が必要な操作
- git commit / push / merge
- 重要ファイルの削除
- 設定ファイル変更

### 自動許可される操作
- ファイル読み取り・編集
- コード分析
- npm install（安全なライブラリ）
- フォーマット・lint

### 使用シーン
- 日常的な開発作業
- 機能追加・バグ修正
- コードレビュー

---

## fast モード

**確認を最小化。高速な反復開発向け。**

### 確認が必要な操作
- git push（リモートへの送信）
- 重要ファイルの削除（src/, .git/ 等）

### 自動許可される操作
- git commit（ローカルのみ）
- ファイル編集・削除（通常ファイル）
- npm install
- フォーマット・lint・テスト実行

### 使用シーン
- プロトタイピング
- 探索的な開発
- 個人プロジェクト
- 学習・実験

### 注意
- git push は常に確認（リモートへの影響があるため）
- 重要ディレクトリの削除は常に確認

---

## 思考法ロード

```
/protection-mode        # 基本（Guard関手 + 3層分類）
/protection-mode full   # フル（+ モード定義）
```

モードは思考の厳格さの目安。`/protection-mode` でガイドラインを読み込むと、状況に応じた判断が可能になる。

---

## モードの永続化

モードは Serena Memory に保存され、セッション間で維持される。

```yaml
memory_key: "session-mode"
content:
  mode: "strict" | "normal" | "fast"
  activated_at: ISO8601
  previous_mode: string | null
```

---

## 8原則との関係

8原則は**すべてのモードで有効**。モードは確認フローの厳格さを制御するのみ。

| 原則 | strict | normal | fast |
|------|--------|--------|------|
| mem（Serena memory） | ✅ | ✅ | ✅ |
| serena（MCP使用） | ✅ | ✅ | ✅ |
| guidelines（自動読込） | ✅ | ✅ | ✅ |
| 自動処理禁止 | ✅厳格 | ✅ | ⚡緩和 |
| 完了通知 | ✅ | ✅ | ✅ |
| 型安全 | ✅ | ✅ | ✅ |
| コマンド提案 | ✅ | ✅ | ✅ |
| 確認済 | ✅厳格 | ✅ | ⚡緩和 |

---

---

## 📊 コンテキスト管理

### MCP制限

```
configured: ≤ 20
enabled:    ≤ 8
tools:      < 50
```

**理由**: MCP過多で 200K → 70K に縮小

### 使用率アクション

```
70%: /compact 実行を検討
85%: 不要なMCP無効化
95%: 新セッション開始
```

### Memory関手

```
F_Memory: ∅ → Context
制約: ∀m ∈ Memory, read(m) ≤ 1回
```

**実践**:
- 起動時1回のみ読込
- 完了タスク即削除
- 繰り返し読込禁止

---

## 関連

- `guardrails.md` - 操作の分類（Safe/Boundary/Forbidden）
- `/protection-mode` コマンド - 圏論的思考法ロード
