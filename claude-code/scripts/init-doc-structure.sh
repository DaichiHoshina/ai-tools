#!/bin/bash

# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹é€ åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§.claudeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ä½œæˆã—ã¾ã™

set -e

# è‰²ä»˜ãå‡ºåŠ›ç”¨ã®é–¢æ•°
print_success() {
    echo -e "\033[0;32mâœ… $1\033[0m"
}

print_error() {
    echo -e "\033[0;31mâŒ $1\033[0m"
}

print_info() {
    echo -e "\033[0;36mğŸ“Œ $1\033[0m"
}

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã®ç¢ºèª
if [ ! -d ".git" ] && [ ! -f "package.json" ] && [ ! -f "Cargo.toml" ] && [ ! -f "go.mod" ]; then
    print_error "è­¦å‘Š: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œã—ã¦ãã ã•ã„"
    read -p "ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# .claudeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
print_info ".claudeãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ä½œæˆã—ã¦ã„ã¾ã™..."

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p .claude/{design,specs/features,history}

# CLAUDE.mdã®ä½œæˆï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰è¨­å®šç”¨ï¼‰
if [ ! -f ".claude/CLAUDE.md" ]; then
    cat > .claude/CLAUDE.md << 'EOF'
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰è¨­å®š

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
[ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚è¦ã‚’è¨˜è¿°]

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- [ä½¿ç”¨ã—ã¦ã„ã‚‹ä¸»è¦ãªæŠ€è¡“ã‚’åˆ—æŒ™]

## é–‹ç™ºè¦ç´„
[ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã‚„å‘½åè¦å‰‡ã‚’è¨˜è¿°]

## é‡è¦ãªæ³¨æ„äº‹é …
[é–‹ç™ºæ™‚ã«ç‰¹ã«æ³¨æ„ã™ã¹ãç‚¹ã‚’è¨˜è¿°]

---
**æ³¨**: ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šã¯ `~/.claude/CLAUDE.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
EOF
    print_success "CLAUDE.mdã‚’ä½œæˆã—ã¾ã—ãŸ"
else
    print_info "CLAUDE.mdã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰"
fi

# READMEã®ä½œæˆ
if [ ! -f ".claude/README.md" ]; then
    cat > .claude/README.md << 'EOF'
# .claude ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½“ç³»çš„ã«ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
.claude/
â”œâ”€â”€ README.md          # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ CLAUDE.md          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è¨­å®š
â”œâ”€â”€ design/            # è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ specs/             # ä»•æ§˜æ›¸
â”‚   â”œâ”€â”€ system.md      # ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ä»•æ§˜ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
â”‚   â””â”€â”€ features/      # æ©Ÿèƒ½åˆ¥ä»•æ§˜æ›¸
â””â”€â”€ history/           # PRå±¥æ­´
```

## ä½¿ã„æ–¹

### æ–°ã—ã„ä»•æ§˜æ›¸ã‚’ä½œæˆ
```bash
~/.claude/scripts/update-docs.sh feature "æ©Ÿèƒ½å" "ãƒ•ã‚¡ã‚¤ãƒ«å"
```

### PRå±¥æ­´ã‚’è¨˜éŒ²
```bash
~/.claude/scripts/add-pr-history.sh <PRç•ªå·> "ã‚¿ã‚¤ãƒˆãƒ«" "ãƒã‚±ãƒƒãƒˆURL"
```

### è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆ
```bash
~/.claude/scripts/update-docs.sh design "è¨­è¨ˆå" "ãƒ•ã‚¡ã‚¤ãƒ«å"
```

## æ³¨æ„äº‹é …

- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼ˆ`~/.claude/`ï¼‰ã®ã‚‚ã®ã‚’ä½¿ç”¨ã—ã¾ã™
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è¨­å®šã¯ `CLAUDE.md` ã«è¨˜è¼‰ã—ã¦ãã ã•ã„
- æ©Ÿå¯†æƒ…å ±ã‚„APIã‚­ãƒ¼ãªã©ã¯è¨˜è¼‰ã—ãªã„ã§ãã ã•ã„

---
è©³ç´°ã¯ `~/.claude/README.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
EOF
    print_success "READMEã‚’ä½œæˆã—ã¾ã—ãŸ"
else
    print_info "READMEã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰"
fi

# .gitignoreã®ç¢ºèªã¨æ›´æ–°
if [ -f ".gitignore" ]; then
    if ! grep -q "^\.claude/settings\.local\.json" .gitignore; then
        echo "" >> .gitignore
        echo "# Claude local settings" >> .gitignore
        echo ".claude/settings.local.json" >> .gitignore
        print_success ".gitignoreã‚’æ›´æ–°ã—ã¾ã—ãŸ"
    fi
fi

# å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
echo ""
print_success "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹é€ ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
echo ""
print_info "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:"
echo "1. .claude/CLAUDE.md ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è¨­å®šã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„"
echo "2. å¿…è¦ã«å¿œã˜ã¦æœ€åˆã®ä»•æ§˜æ›¸ã‚’ä½œæˆã—ã¦ãã ã•ã„:"
echo "   ~/.claude/scripts/update-docs.sh feature \"æœ€åˆã®æ©Ÿèƒ½\" \"first-feature\""
echo ""
print_info "ãƒ’ãƒ³ãƒˆ: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã‹ã‚‰ä½¿ç”¨ã§ãã¾ã™:"
echo "- ~/.claude/scripts/update-docs.sh"
echo "- ~/.claude/scripts/add-pr-history.sh"